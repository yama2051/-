<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.employee.mapper.EmployeeMapper">

	<resultMap id="DetailedEmployeeResultMap" type="com.example.employee.entity.EmployeeEntity">
		<id column="employee_id" property="employeeId"></id>
		<result column="last_name" property="lastName"></result>
		<result column="first_name" property="firstName"></result>
		<result column="status" property="status"></result>
		<result column="delete_flg" property="deleteFlg"></result>
		<result column="created_at" property="createdAt"></result>
		<result column="updated_at" property="updatedAt"></result>
		
		<!--詳細情報-->
		<association property="detail" javaType="com.example.employee.entity.EmployeeDeitalInfEntity">
        	<result column="email" property="email" />
        	<result column="extension_number" property="extensionNumber" />
        	<result column="hire_date" property="hireDate" />
        	<result column="memo" property="memo" />
    	</association>
    	
	</resultMap>
	
	<!--検索用（全件取得）-->
	<select	id="findAll" resultMap="DetailedEmployeeResultMap">
		SELECT 
        	* FROM 
        employee
    	<where>
       	 delete_flg = '0'

        <if test="employeeId != null and employeeId != ''">
            AND employee_id = #{employeeId}
        </if>

        <if test="lastName != null and lastName != ''">
            AND last_name LIKE CONCAT('%', #{lastName}, '%')
        </if>

        <if test="departmentId != null and departmentId != ''">
            AND department_id = #{departmentId}
        </if>
    </where>
	</select>
	
	<!--登録用-->
	<insert id="registMem">
		INSERT EMPLOYEE(employee_id,last_name,first_name,status,delete_flg,created_at,updated_at)
		VALUES(#{employeeId},#{lastName},#{firstName},#{status},#{deleteFlg},#{createdAt},#{updatedAt})
	</insert>
	
	<!--詳細画面用-->
	<select id="findMemDetail" resultMap="DetailedEmployeeResultMap">
    SELECT
        e.employee_id,
        e.last_name,
        e.first_name,
        e.department_id,
        e.status,
        ed.email,
        ed.extension_number,
        ed.hire_date,
        ed.memo
    FROM
        employee e
    LEFT JOIN 
        employee_details ed ON e.employee_id = ed.employee_id
    WHERE
        e.employee_id = #{employeeId}
        AND e.delete_flg = '0'
	</select>
	


</mapper>
